ext-AdministrationAgreement.AdditionalInformation:
  zib deviations:
    Extension.value[x]:
      - cardinality:  0..1
        reason: The extension allows the value to occure only once (0..1), but the use of the extension itself (in a resource)is allowed to be repeated (0..*), effectively resulting a cardinality of 0..* for this element.

ext-DispenseRequest.AdditionalWishes:
  zib deviations:
    Extension.value[x]:
      - cardinality:  0..1
        reason: The extension allows the value to occure only once (0..1), but the use of the extension itself (in a resource)is allowed to be repeated (0..*), effectively resulting a cardinality of 0..* for this element.

ext-DispenseRequest.DispenseLocation:
  zib deviations:
    Extension.value[x]:
      - datatype:  Reference
        reason: Although the mapping is placed on a Reference and not a String, the actual information will be placed inside a String datatype in Location.name. A reference to a Location resource has been chosen over an extension with a String to allow for more detailed information to be captured in use cases not accounted for by the zib while also provide a correct zib mapping. 

ext-LanguageProficiency.CommunicationDetails:
  zib deviations:
    Extension.value[x]:
      - cardinality: 0..1
        reason: FHIR restricts Extension.value to a max cardinality of 0..1. To use it more than once, the extension should be added 0..* in the hosting element.

ext-MedicationAgreement.MedicationAgreementAdditionalInformation:
  zib deviations:
    Extension.value[x]:
      - cardinality:  0..1
        reason: The extension allows the value to occure only once (0..1), but the use of the extension itself (in a resource)is allowed to be repeated (0..*), effectively resulting a cardinality of 0..* for this element.

ext-MedicationDispense.MedicationDispenseAdditionalInformation:
  zib deviations:
    Extension.value[x]:
      - cardinality:  0..1
        reason: The extension allows the value to occure only once (0..1), but the use of the extension itself (in a resource)is allowed to be repeated (0..*), effectively resulting a cardinality of 0..* for this element.

ext-MedicationUse.AsAgreedIndicator:
  zib deviations:
    Extension.value[x]:
      - cardinality:  0..1
        reason: The extension allows the value to occure only once (0..1), but the use of the extension itself (in a resource)is allowed to be repeated (0..*), effectively resulting a cardinality of 0..* for this element.

pattern-NlCoreHealthProfessionalReference:
  ignored issues:
    StructureDefinition:
      - message: "sd-pg-08: 'The title of the StructureDefinition should conform to the profiling guidelines'"
        reason: The title is shown in the hosting profiles as the name of the datatype. "zib HealthProfessional Reference" is more descriptive than the title according to the profiling guidelines ("pattern NlCoreHealthProfessionalReference").

pattern-GstdSimpleQuantity:
  ignored issues:
    StructureDefinition:
      - message: "sd-pg-08: 'The title of the StructureDefinition should conform to the profiling guidelines'"
        reason: The title is shown in the hosting profiles as the name of the datatype. "G-Standaard SimpleQuantity" is more descriptive than the title according to the profiling guidelines ("pattern GstdSimpleQuantity").

pattern-GstdQuantity: 
  ignored issues:
    StructureDefinition:
      - message: "sd-pg-08: 'The title of the StructureDefinition should conform to the profiling guidelines'"
        reason: The title is shown in the hosting profiles as the name of the datatype. "G-Standaard Quantity" is more descriptive than the title according to the profiling guidelines ("pattern GstdQuantity").

pattern-ZibHealthProfessionalReference:
  ignored issues:
    StructureDefinition:
      - message: "sd-pg-08: 'The title of the StructureDefinition should conform to the profiling guidelines'"
        reason: The title is shown in the hosting profiles as the name of the datatype. "zib HealthProfessional Reference" is more descriptive than the title according to the profiling guidelines ("pattern ZibHealthProfessionalReference").

zib-AddressInformation:
  zib deviations:
    Address.line.extension:houseNumberIndication.value[x]:
      - datatype: string
        reason: The mapping of zib AddressInformation on the FHIR Address datatype is the result of compatibility with HL7v3, which is the format that a lot of healthcare data in the Netherlands is stored in.  As a result of this, the zib HouseNumberIndication concept with CD datatype is mapped to a FHIR string datatype with a constraint added (the value can only be 'by' or 'to').

zib-AdministrationAgreement:
  zib deviations:
    MedicationDispense.status:
      - datatype: code
        reason: CanceledIndicator can be mapped to the status element that holds an appropriate code for when CanceledIndicator = true. 
      - cardinality: 1..1
        reason: The base FHIR spect defines status as 1..1. This is not a problem for the mapping of CanceledIndicator because if CanceledIndicator is absent or false another more appropriate code should be chosen for this mandatory element.
    MedicationDispense.note.text:
      - cardinality:  1..1
        reason: The text element makes the value required (1..1), but the use of the note itself is optional (0..1), effectively resulting a cardinality of 0..1 for this element.
    MedicationDispense.performer.actor:
      - cardinality:  1..1
        reason: The actor element makes the value required (1..1), but the use of the performer itself is optional (0..1), effectively resulting a cardinality of 0..1 for this element.    
    MedicationDispense.dosageInstruction:
      - datatype: Dosage
        reason: InstructionsForUse and DosingInstructions are represented by the Dosage datatype and not by a resource in FHIR hence the mismatch in datatypes.
      - cardinality:  0..*
        reason: This Dosage datatype _mainly_ represents the DosingInstructions concept of InstructionsForUse which has a cardinality of 0..*.
    MedicationDispense.extension:periodOfUse-Period.value[x]:
      - datatype: Period
        reason: The zib TimerInterval is not represented as a resource but is rather mapped within the zib profile. Therefore no Reference is used, explaining the deviation with the zib, but a Period as would have been the case within the zib TimeInterval.
    MedicationDispense.extension:periodOfUse-Duration.value[x]:        
      - datatype: Duration
        reason: The zib TimerInterval is not represented as a resource but is rather mapped within the zib profile. Therefore no Reference is used, explaining the deviation with the zib, but a Duration as would have been the case within the zib TimeInterval.
        
zib-ContactInformation-TelephoneNumbers:
  zib deviations:
    ContactPoint.system:
      - cardinality: 1..1
        reason: Although TelecomType and NumberType are optional in the zib, ContactPoint.system is used to identify the TelephoneNumbers concept itself when this datatype is added to a profile. If only a telephone number is given without TelecomType and NumberType, this will fall in the default slice of the profile.

zib-ContactPerson:
  zib deviations:
    RelatedPerson.name:
      - cardinality: 0..*
        reason: The cardinality mismatch between the zib (0..1) and FHIR (0..*) is explained by the presence of the HumanName.use element. A full name can be broken into parts using multiple instances of HumanName that have its own value for use. Documented in the profile too.
      - datatype: HumanName
        reason: A name in FHIR is represented using the HumanName datatype, not as a separate resource.
    RelatedPerson.address:
      - datatype: Address
        reason: An address in FHIR is represented using the Address datatype, not as a separate resource.
      - cardinality: 0..*
        reason: The zib AddressInformation may be represented using multiple FHIR Address instances, hence the cardinality is wider.
    RelatedPerson.telecom:
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource.
      - cardinality: 0..*
        reason: The cardinality mismatch between the zib (0..1) and FHIR (0..*) is explained by the containers TelephoneNumbers (0..*) and EmailAddresses (0..*) inside the ContactInformation model. The FHIR datatype ContactPoint does not have these containers.
    RelatedPerson.telecom:telephoneNumbers:
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource.
    RelatedPerson.telecom:emailAddresses:
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource.

zib-DispenseRequest:
  zib deviations:
    MedicationRequest.note.text:
      - cardinality:  1..1
        reason: The text element makes the value required (1..1), but the use of the note itself is optional (0..1), effectively resulting a cardinality of 0..1 for this element.
    MedicationRequest.dispenseRequest.extension:periodOfUse-Duration.value[x]:
      - datatype: Duration
        reason: The zib TimerInterval is not represented as a resource but is rather mapped within the zib profile. Therefore no Reference is used, explaining the deviation with the zib, but a Duration as would have been the case within the zib TimeInterval.
    MedicationRequest.dispenseRequest.validityPeriod:
      - datatype: Period
        reason: The zib TimerInterval is not represented as a resource but is rather mapped within the zib profile. Therefore no Reference is used, explaining the deviation with the zib, but a Period as would have been the case within the zib TimeInterval.
    MedicationRequest.dispenseRequest.numberOfRepeatsAllowed:
      - datatype: unsignedInt
        reason: unsignedInt is a restriction on the zib INT concept (only non-negative INT) which matches with the definition of the NumberOfRefills. A negative NumberOfRefills don't make sense. 
    
zib-HealthcareProvider:
  zib deviations:
    Location.address:
      - datatype: Address
        reason: An address in FHIR is represented using the Address datatype, not as a separate resource.
      - cardinality: 0..1
        reason: The cardinality mismatch with the zib (0..1 versus 0..*) is explained by the restriction of FHIR to limit the Location.address to a physical address while the zib allows for other types of addresses (e.g. a postal address). Other types of addresses than a physical address are given in Organization.address which is referenced by Location.managingOrganization. More documentation can be found at https://github.com/Nictiz/Nictiz-R4-zib2020/issues/38
    Location.telecom:
      - cardinality: 0..*
        reason: The cardinality mismatch between the zib (0..1) and FHIR (0..*) is explained by the missing root element of zib part ContactInformation in FHIR. Instead, the two containers of the zib (TelephoneNumbers and EmailAddresses), which both have a cardinality of 0..*, are mapped directly into the resource. Thereby still honoring the cardinality requirements of the zib.
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource. Because the FHIR profile for ContactInformation consits of two parts the rootconcept of the ContactInformation is mapped on .telecom.
    Location.telecom:telephoneNumbers:
      - datatype: ContactPoint
        reason: See Location.telecom
    Location.telecom:emailAddresses:
      - datatype: ContactPoint
        reason: See Location.telecom

unmapped zib concepts:
  - NL-CM:17.2.10: HealthcareProvider.LocationNumber
    reason: This zib concept is problematic to map cleanly to FHIR and it has been deemed too uncommon in practice to warrant an extension.

zib-HealthProfessional-Practitioner:
  zib deviations:
    Practitioner.name:
      - cardinality: 0..*
        reason: The cardinality mismatch between the zib (0..1) and FHIR (0..*) is explained by the presence of the HumanName.use element. A full name can be broken into parts using multiple instances of HumanName that have its own value for use. Documented in the profile too.
      - datatype: HumanName
        reason: A name in FHIR is represented using the HumanName datatype, not as a separate resource.
    Practitioner.telecom:
      - cardinality: 0..*
        reason: The cardinality mismatch between the zib (0..1) and FHIR (0..*) is explained by the missing root element of zib part ContactInformation in FHIR. Instead, the two containers of the zib (TelephoneNumbers and EmailAddresses), which both have a cardinality of 0..*, are mapped directly into the resource. Thereby still honoring the cardinality requirements of the zib.
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource. Because the FHIR profile for ContactInformation consits of two parts the rootconcept of the ContactInformation is mapped on .telecom.
    Practitioner.telecom:telephoneNumbers:
      - datatype: ContactPoint
        reason: See Practitioner.telecom
    Practitioner.telecom:emailAddresses:
      - datatype: ContactPoint
        reason: See Practitioner.telecom
    Practitioner.address:
      - datatype: Address
        reason: An address in FHIR is represented using the Address datatype, not as a separate resource.
      - cardinality: 0..*
        reason: The zib AddressInformation may be represented using multiple FHIR Address instances, hence the cardinality is wider.
        
zib-HealthProfessional-PractitionerRole:
  zib deviations:
    PractitionerRole.telecom:
      - cardinality: 0..*
        reason: The cardinality mismatch between the zib (0..1) and FHIR (0..*) is explained by the missing root element of zib part ContactInformation in FHIR. Instead, the two containers of the zib (TelephoneNumbers and EmailAddresses), which both have a cardinality of 0..*, are mapped directly into the resource. Thereby still honoring the cardinality requirements of the zib.
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource. Because the FHIR profile for ContactInformation consits of two parts the rootconcept of the ContactInformation is mapped on .telecom.
    PractitionerRole.telecom:telephoneNumbers:
      - datatype: ContactPoint
        reason: See PractitionerRole.telecom
    PractitionerRole.telecom:emailAddresses:
      - datatype: ContactPoint
        reason: See PractitionerRole.telecom

zib-MedicationAdministration2:
  zib deviations:
    MedicationAdministration.note.text:
      - cardinality:  1..1
        reason: The text element makes the value required (1..1), but the use of the note itself is optional (0..1), effectively resulting a cardinality of 0..1 for this element.
    MedicationAdministration.status:
      - cardinality:  1..1
        reason: TODO
    MedicationAdministration.performer:
      - datatype: BackboneElement
        reason: The appropriate representation of Administrator of a MedicationAdministration in FHIR is the performer. The container can be properly mapped to this BackboneElement.
    MedicationAdministration.dosage.rate[x]:
      - datatype: Ratio
        reason: There is no profile for a reference to the partial zib Range because the relevant parts will be modelled directly in the profile.

zib-MedicationAgreement:
  zib deviations:
    MedicationRequest.note.text:
      - cardinality:  1..1
        reason: The text element makes the value required (1..1), but the use of the note itself is optional (0..1), effectively resulting a cardinality of 0..1 for this element.
    MedicationRequest.extension:additionalInformation.value[x]:
      - cardinality:  0..1
        reason: The used extension allows the value to occure only once (0..1), but the use of the extension itself is allowed to be repeated (0..*), effectively resulting a cardinality of 0..* for this element.
    MedicationRequest.dosageInstruction:
      - cardinality:  0..*
        reason: DosageInstructions is profiled on a datatype level (Dosage) and not a resource. In FHIR the root concepts of InstructionsForUse do not all extist in the Dosage datatype. These are represented in the resource that includes the Dosage information. Therefore, the cardinality needs to be 0..* because the zib container DosageInstruction within InstructionsForUse is also 0..*. 
      - datatype: Dosage
        reason: DosageInstructions in FHIR is represented using the Dosage datatype, not as a separate resource.
    MedicationRequest.extension:periodOfUse-Duration.value[x]:
      - datatype: Duration
        reason: The zib TimerInterval is not represented as a resource but is rather mapped within the zib profile. Therefore no Reference is used, explaining the deviation with the zib, but a Duration as would have been the case within the zib TimeInterval.
    MedicationRequest.extension:periodOfUse-Period.value[x]:
      - datatype: Period
        reason: The zib TimerInterval is not represented as a resource but is rather mapped within the zib profile. Therefore no Reference is used, explaining the deviation with the zib, but a Period as would have been the case within the zib TimeInterval.
    
zib-MedicationDispense:
  zib deviations:
    MedicationDispense.note.text:
      - cardinality:  1..1
        reason: The text element makes the value required (1..1), but the use of the note itself is optional (0..1), effectively resulting a cardinality of 0..1 for this element.
    MedicationDispense.performer.actor:
      - cardinality:  1..1
        reason: The actor element makes the value required (1..1), but the use of the performer itself is optional (0..1), effectively resulting a cardinality of 0..1 for this element.
    MedicationDispense.destination:
      - datatype: Reference
        reason: A mapping to a native FHIR element, this reference to a Location, has been chosen over the use of an extension. The actual information will be placed inside a string datatype in Location.name matching the datatype of the zib.

zib-MedicationUse2:
  zib deviations:
    MedicationStatement.note.text:
      - cardinality:  1..1
        reason: The text element makes the value required (1..1), but the use of the note itself is optional (0..1), effectively resulting a cardinality of 0..1 for this element.
    MedicationStatement.extension:periodOfUse-Duration.value[x]:
      - datatype: Duration
        reason: The zib TimerInterval is not represented as a resource but is rather mapped within the zib profile. Therefore no Reference is used, explaining the deviation with the zib, but a Duration as would have been the case within the zib TimeInterval.
    MedicationStatement.effective[x]:effectivePeriod:
      - datatype: Period
        reason: The zib TimerInterval is not represented as a resource but is rather mapped within the zib profile. Therefore no Reference is used, explaining the deviation with the zib, but a Period as would have been the case within the zib TimeInterval.
    MedicationStatement.dosage:
      - cardinality:  0..*
        reason: DosageInstructions is profiled on a datatype level (Dosage) and not a resource. In FHIR the root concepts of InstructionsForUse do not all extist in the Dosage datatype. These are represented in the resource that includes the Dosage information. Therefore, the cardinality needs to be 0..* because the zib container DosageInstruction within InstructionsForUse is also 0..*. 
      - datatype: Dosage
        reason: DosageInstructions in FHIR is represented using the Dosage datatype, not as a separate resource.
    
zib-NameInformation:
  zib deviations:
    HumanName.prefix:
      - cardinality: 0..*
        reason: prefix and suffix are mapped to the "titles" concept from the zib. There's a mismatch however in the way this information is represented in the zib and in FHIR. The mapping is documented in the profile.
    HumanName.suffix:
      - cardinality: 0..*
        reason: prefix and suffix are mapped to the "titles" concept from the zib. There's a mismatch however in the way this information is represented in the zib and in FHIR. The mapping is documented in the profile.

zib-Patient:
  zib deviations:
    Patient.extension:nationality.extension:code.value[x]:
      - cardinality: 1..1
        reason: The used extension uses a cardinality of 1..1 on the value[x] element. However, the extension itself is added with a cardinality of 0..1.
    Patient.name:
      - cardinality: 0..*
        reason: The cardinality mismatch between the zib (0..1) and FHIR (0..*) is explained by the presence of the HumanName.use element. A full name can be broken into parts using multiple instances of HumanName that have its own value for use. Documented in the profile too.
      - datatype: HumanName
        reason: A name in FHIR is represented using the HumanName datatype, not as a separate resource.
    Patient.telecom:
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource.
      - cardinality: 0..*
        reason: The cardinality mismatch between the zib (0..1) and FHIR (0..*) is explained by the containers TelephoneNumbers (0..*) and EmailAddresses (0..*) inside the ContactInformation model. The FHIR datatype ContactPoint does not have these containers.
    Patient.telecom:telephoneNumbers:
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource.
    Patient.telecom:emailAddresses:
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource.
    Patient.address:
      - datatype: Address
        reason: An address in FHIR is represented using the Address datatype, not as a separate resource.
      - cardinality: 0..*
        reason: The zib AddressInformation may be represented using multiple FHIR Address instances, hence the cardinality is wider.
    Patient.deceased[x]:deceasedDateTime:
      - short: DateOfDeath
        reason: This element is mapped to two zib concepts, DateOfDeath and DeathIndicator. However, the latter is implicit -- althougt the zib recognizes both concepts, FHIR supports populating just one of them, thus DeathIndicator is assumed to be true when DateOfDeath is populated. For clarity reasons, the metadata of deceasedDateTime is only mapped to DateOfDeath.
      - datatype: dateTime
        reason: The boolean expected by DeathIndicator is only assumed; see the explanation above.
    Patient.contact:
      - datatype: BackboneElement
        reason: The zib ContactPerson _may_ be represented as Patient.contact. There is a different use case as well, where the ContactPerson is implemented using a RelatedPerson resource.
      - cardinality: 0..*
        reason: A patient may have multiple contacts. The expected cardinality of 0..1 stems from the root concept of zib ContactPerson, but this cardinality is essentially without meaning.
    Patient.contact.extension:contactPerson.value[x]:
      - datatype: Reference
        reason: This is an additional reference to a separate zib-ContactPerson (RelatedPerson) instance, next to the information in Pateint.contact. Patient.contact and RelatedPerson can both be used to capture the information from zib-ContactPerson, but each are used within a different context. Information may therefore be duplicated; this is the recommended way.
    Patient.contact.name:
      - datatype: HumanName
        reason: A name in FHIR is represented using the HumanName datatype, not as a separate resource.
    Patient.contact.telecom:
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource.
      - cardinality: 0..*
        reason: The cardinality mismatch between the zib (0..1) and FHIR (0..*) is explained by the containers TelephoneNumbers (0..*) and EmailAddresses (0..*) inside the ContactInformation model. The FHIR datatype ContactPoint does not have these containers.
    Patient.contact.telecom:telephoneNumbers:
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource.
    Patient.contact.telecom:emailAddresses:
      - datatype: ContactPoint
        reason: ContactInformation in FHIR is represented using the ContactPoint datatype, not as a separate resource.
    Patient.contact.address:
      - datatype: Address
        reason: An address in FHIR is represented using the Address datatype, not as a separate resource.
      - cardinality: 0..1
        reason: Patient.contact is a restricted representation of contact persons containing only information needed to contact a contact person. The full address information should be captured using an instance of the zib-ContactPerson profile on RelatedPerson, which can be linked using an extension. This is explained in the profile.  
    Patient.communication:
      - datatype: BackboneElement
        reason: The appropriate representation of zib LanguageProficiency in FHIR is Patient.communication, not a separate resource.
      - cardinality: 0..*
        reason: A patient may be proficient in multiple languages. The expected cardinality of 0..1 stems from the root concept of zib LanguageProficiency, but this cardinality is essentially without meaning.
    Patient.communication.language:
      - cardinality: 1..1
        reason: The FHIR profiles are expected to implement zib cardinalities as conceptual cardinalities, but FHIR requires the language element to be present. This aligns with the intention of the zib, as the Language concept is required for zib LanguageProficiency to make sense.
    Patient.communication.extension:languageControl:
      - short: LanguageControlListening / LanguageControlSpeaking / LanguageControlReading
        reason: Three zib concepts are mapped to one extension in FHIR and are differentiated by their type value.
      - datatype: Extension
        reason: The mapping is placed on the extension and not on the value[x] because of the nature of this extension. The extension itself contains a valueCoding that gets the zibs value. This datatype matches the zib CD type.
      - cardinality: 0..*
        reason: Because of the nature of this extension the cardinality has a mismatch. Three zib concepts are mapped to this extension. Therefore the extension cannot be 0..1, but should be able to repeat.

zib-PharmaceuticalProduct:
  zib deviations:
    Medication.ingredient:
      - datatype: BackboneElement
        reason: The appropriate representation of ingredient in FHIR is Medication.ingredient. The container can be properly mapped to this BackboneElement.
    Medication.ingredient.strength:
      - datatype: Ratio
        reason: The `ingredient.strenght` acts as a container for the two child elements and can the be correclty mapped to the zib Concentration container. 
    Medication.ingredient.item[x]:
      - cardinality: 1..1
        reason: There is a known cardinality mismatch between FHIR (1..1) and the zib (0..1) for the .ingredient.item element which is nested in the optional .ingredient container. This constraint was already in place for the STU3 profile. Moreover this does not seem to be a concern for the Medication Proces information standard will use this profile as they will make this element required in their dataset.
